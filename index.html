<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeria Botànica UAB</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --primary: #2c5530;
            --primary-dark: #1a3a1d;
            --secondary: #8bc34a;
            --accent: #ffc107;
            --danger: #dc3545;
            --success: #28a745;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .gradient-header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
        }

        .plant-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .plant-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .modal-backdrop {
            backdrop-filter: blur(4px);
            background-color: rgba(0, 0, 0, 0.5);
        }

        .toast {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .image-thumb {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
        }

        .image-thumb img {
            transition: transform 0.3s ease;
        }

        .image-thumb:hover img {
            transform: scale(1.1);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            background-color: #e5e7eb;
            color: #1976d2;
            border-radius: 9999px;
            font-size: 0.875rem;
            margin: 0.25rem;
        }

        .tag-remove {
            cursor: pointer;
            margin-left: 0.25rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .drop-zone {
            border: 2px dashed #ccc;
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .drop-zone.dragover {
            border-color: var(--primary);
            background-color: rgba(44, 85, 48, 0.1);
        }

        .json-preview {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 0.5rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --primary: #4a7c4e;
                --primary-dark: #2c5530;
                --secondary: #aed581;
            }

            body {
                background-color: #111827;
                color: #e5e7eb;
            }

            .plant-card {
                background-color: #1f2937;
                border-color: #374151;
            }

            .tag {
                background-color: #374151;
                color: #81c784;
            }

            .json-preview {
                background-color: #374151;
                border-color: #4b5563;
                color: #aed581;
            }

            input, select, textarea {
                background-color: #374151;
                color: #e5e7eb;
                border-color: #4b5563;
            }

            ::placeholder {
                color: #9ca3af;
            }
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900">
    <!-- Header -->
    <header class="gradient-header text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <i class="fas fa-leaf text-4xl text-green-300"></i>
                    <div>
                        <h1 class="text-3xl font-bold">Galeria Botànica UAB</h1>
                        <p class="text-green-200 text-sm">Catàleg de plantes del campus</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <input type="file" id="jsonFileInput" accept=".json,application/json" class="hidden">

                    <button onclick="document.getElementById('jsonFileInput').click()"
                            class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-file-upload mr-2"></i>Importar JSON
                    </button>

                    <button id="openJsonFS"
                            class="hidden bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-folder-open mr-2"></i>Obrir JSON (FS)
                    </button>

                    <button onclick="exportJSON()" 
                            class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition">
                        <i class="fas fa-download mr-2"></i>Exportar JSON
                    </button>

                    <button onclick="openPlantModal()" 
                            class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>Nova Planta
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Search and Filters -->
    <div class="container mx-auto px-4 py-6">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-md p-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="md:col-span-2">
                    <div class="relative">
                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="searchInput" placeholder="Cercar per nom comú, científic o família..." 
                               class="w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    </div>
                </div>
                <select id="filterFamily" class="px-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500">
                    <option value="">Totes les famílies</option>
                </select>
                <select id="filterType" class="px-4 py-3 border rounded-lg focus:ring-2 focus:ring-green-500">
                    <option value="">Tots els tipus</option>
                    <option value="arbre">Arbre</option>
                    <option value="arbust">Arbust</option>
                    <option value="herba">Herba</option>
                    <option value="enfiladissa">Enfiladissa</option>
                </select>
            </div>
            <div class="mt-4 flex flex-wrap gap-2" id="activeFilters"></div>
        </div>
    </div>

    <!-- Plants Grid -->
    <div class="container mx-auto px-4 pb-8">
        <div id="plantsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <!-- Plant cards will be dynamically inserted here -->
        </div>
        
        <!-- Loading indicator -->
        <div id="loadingIndicator" class="hidden flex justify-center py-12">
            <div class="spinner"></div>
        </div>
        
        <!-- Empty state -->
        <div id="emptyState" class="text-center py-12">
            <i class="fas fa-seedling text-6xl text-gray-300 mb-4"></i>
            <p class="text-xl text-gray-500">Galeria buida</p>
            <p class="text-gray-400 mt-2">Comença afegint la primera planta</p>
        </div>
    </div>

    <!-- Plant Modal -->
    <div id="plantModal" class="hidden fixed inset-0 z-50 overflow-y-auto">
        <div class="modal-backdrop fixed inset-0" onclick="closePlantModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden relative">
                <!-- Modal Header -->
                <div class="gradient-header text-white px-6 py-4 flex justify-between items-center">
                    <h2 id="modalTitle" class="text-2xl font-bold">Nova Planta</h2>
                    <button onclick="closePlantModal()" class="text-white/80 hover:text-white text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Modal Body -->
                <div class="overflow-y-auto max-h-[calc(90vh-8rem)] p-6">
                    <form id="plantForm" class="space-y-6">
                        <!-- Identificació -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                            <h3 class="font-bold text-lg mb-4 text-green-700 dark:text-green-400">
                                <i class="fas fa-id-card mr-2"></i>Identificació
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Nom comú *</label>
                                    <input type="text" name="nom_comu" required
                                           class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Nom científic *</label>
                                    <input type="text" name="nom_cientific" required
                                           class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Família</label>
                                    <input type="text" name="familia"
                                           class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Tipus</label>
                                    <select name="tipus" class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="">Selecciona...</option>
                                        <option value="arbre">Arbre</option>
                                        <option value="arbust">Arbust</option>
                                        <option value="herba">Herba</option>
                                        <option value="enfiladissa">Enfiladissa</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Descripció -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                            <h3 class="font-bold text-lg mb-4 text-green-700 dark:text-green-400">
                                <i class="fas fa-align-left mr-2"></i>Descripció
                            </h3>
                            <textarea name="descripcio" rows="4" 
                                      class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500"
                                      placeholder="Descripció detallada de la planta..."></textarea>
                        </div>

                        <!-- Mapa -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
                            <h3 class="font-bold text-lg mb-4 text-green-700 dark:text-green-400">
                                <i class="fas fa-map-marker-alt mr-2"></i>Ubicació
                            </h3>
                            <div id="map" style="height: 300px; border-radius: 0.5rem;"></div>
                            <p class="text-sm text-gray-500 mt-2">Fes clic al mapa per afegir una ubicació</p>
                            <div id="coordinatesList" class="mt-2 space-y-1"></div>
                        </div>
                    </form>
                </div>
                
                <!-- Modal Footer -->
                <div class="border-t px-6 py-4 flex justify-between items-center bg-gray-50 dark:bg-gray-700">
                    <button type="button" onclick="closePlantModal()" 
                            class="px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900">
                        Cancel·lar
                    </button>
                    <button type="button" onclick="savePlant()" 
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold">
                        <i class="fas fa-check mr-2"></i>Desar planta
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="hidden fixed inset-0 z-50">
        <div class="modal-backdrop fixed inset-0" onclick="closeDeleteModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-md w-full p-6">
                <div class="text-center">
                    <i class="fas fa-exclamation-triangle text-5xl text-red-500 mb-4"></i>
                    <h3 class="text-2xl font-bold mb-2">Eliminar planta?</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6">
                        Aquesta acció no es pot desfer.
                    </p>
                    <div class="flex justify-center gap-4">
                        <button onclick="closeDeleteModal()"
                                class="px-6 py-2 rounded-lg bg-gray-200 text-gray-800 hover:bg-gray-300">
                            Cancel·lar
                        </button>
                        <button onclick="confirmDelete()"
                                class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold">
                            Eliminar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Global variables
        let plantsData = [];
        let currentPlantId = null;
        let map = null;
        let markers = [];
        let plantToDelete = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            initializeMap();
            loadInitialData();
            
            // File System API support
            if ('showOpenFilePicker' in window) {
                document.getElementById('openJsonFS').classList.remove('hidden');
                document.getElementById('openJsonFS').addEventListener('click', openFileSystemJSON);
            }
        });

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', filterPlants);
            document.getElementById('filterFamily').addEventListener('change', filterPlants);
            document.getElementById('filterType').addEventListener('change', filterPlants);
            document.getElementById('jsonFileInput').addEventListener('change', handleJSONFile);
        }

        async function loadInitialData() {
            showLoading(true);
            
            // Crear dades d'exemple per demostració
            plantsData = [
                {
                    id: "oliver",
                    nom_comu: "Oliver",
                    nom_cientific: "Olea europaea",
                    familia: "Oleaceae",
                    tipus: "arbre",
                    descripcio: "Arbre mediterrani emblemàtic, de fulles perennes i fruits comestibles.",
                    coordenades: [{ lat: 41.500833, lng: 2.107222 }]
                },
                {
                    id: "pi_blanc",
                    nom_comu: "Pi blanc",
                    nom_cientific: "Pinus halepensis",
                    familia: "Pinaceae",
                    tipus: "arbre",
                    descripcio: "Conífera típica del mediterrani, molt resistent a la sequera.",
                    coordenades: [{ lat: 41.501000, lng: 2.107500 }]
                },
                {
                    id: "rosella",
                    nom_comu: "Rosella",
                    nom_cientific: "Nerium oleander",
                    familia: "Apocynaceae",
                    tipus: "arbust",
                    descripcio: "Arbust ornamental de flors vistoses, tòxic però molt decoratiu.",
                    coordenades: [{ lat: 41.500500, lng: 2.106800 }]
                }
            ];
            
            displayPlants(plantsData);
            updateFilters();
            showLoading(false);
            showToast('Galeria carregada amb dades d\'exemple', 'success');
        }

        async function openFileSystemJSON() {
            try {
                const [fileHandle] = await window.showOpenFilePicker({
                    types: [{ accept: { 'application/json': ['.json'] } }],
                    excludeAcceptAllOption: true,
                    multiple: false
                });

                const file = await fileHandle.getFile();
                const text = await file.text();
                let data = JSON.parse(text);
                
                if (!Array.isArray(data)) {
                    if (Array.isArray(data.plantes)) data = data.plantes;
                    else if (Array.isArray(data.data)) data = data.data;
                }

                if (!Array.isArray(data)) {
                    showToast('El JSON no té el format esperat', 'error');
                    return;
                }

                plantsData = data;
                displayPlants(plantsData);
                updateFilters();
                showToast('Fitxer JSON carregat correctament', 'success');
            } catch (err) {
                console.error(err);
                showToast('No s\'ha pogut obrir el fitxer', 'error');
            }
        }

        async function handleJSONFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                let data = JSON.parse(text);

                if (!Array.isArray(data)) {
                    if (Array.isArray(data.plantes)) data = data.plantes;
                    else if (Array.isArray(data.data)) data = data.data;
                }

                if (!Array.isArray(data)) {
                    showToast('El JSON no té el format esperat', 'error');
                    return;
                }

                plantsData = data;
                displayPlants(plantsData);
                updateFilters();
                showToast('Fitxer JSON importat correctament', 'success');
            } catch (err) {
                console.error(err);
                showToast('Error llegint el fitxer JSON', 'error');
            }
        }

        function displayPlants(plants) {
            const grid = document.getElementById('plantsGrid');
            const emptyState = document.getElementById('emptyState');
            
            if (plants.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            grid.innerHTML = plants.map(plant => createPlantCard(plant)).join('');
        }

        function createPlantCard(plant) {
            return `
                <div class="plant-card bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden">
                    <div class="h-48 bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center">
                        <i class="fas fa-leaf text-6xl text-white/80"></i>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg mb-1">${plant.nom_comu}</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-400 italic mb-2">${plant.nom_cientific}</p>
                        <p class="text-sm text-gray-500 mb-3">
                            <i class="fas fa-sitemap mr-1"></i>${plant.familia || 'Sense família'}
                        </p>
                        <div class="flex justify-between items-center mt-4">
                            <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-2 py-1 rounded-full text-xs font-semibold">
                                ${plant.tipus || 'planta'}
                            </span>
                            <div class="flex gap-2">
                                <button onclick="editPlant('${plant.id}')" 
                                        class="text-blue-600 hover:text-blue-700 p-2">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deletePlant('${plant.id}')" 
                                        class="text-red-600 hover:text-red-700 p-2">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function filterPlants() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const familyFilter = document.getElementById('filterFamily').value;
            const typeFilter = document.getElementById('filterType').value;
            
            const filtered = plantsData.filter(plant => {
                const matchesSearch = !searchTerm || 
                    plant.nom_comu.toLowerCase().includes(searchTerm) ||
                    plant.nom_cientific.toLowerCase().includes(searchTerm) ||
                    (plant.familia && plant.familia.toLowerCase().includes(searchTerm));
                
                const matchesFamily = !familyFilter || plant.familia === familyFilter;
                const matchesType = !typeFilter || plant.tipus === typeFilter;
                
                return matchesSearch && matchesFamily && matchesType;
            });
            
            displayPlants(filtered);
        }

        function updateFilters() {
            const families = [...new Set(plantsData.map(p => p.familia).filter(Boolean))];
            const familySelect = document.getElementById('filterFamily');
            
            familySelect.innerHTML = '<option value="">Totes les famílies</option>' +
                families.sort().map(f => `<option value="${f}">${f}</option>`).join('');
        }

        function openPlantModal(plantId = null) {
            currentPlantId = plantId;
            const modal = document.getElementById('plantModal');
            const form = document.getElementById('plantForm');
            const title = document.getElementById('modalTitle');
            
            form.reset();
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            updateCoordinatesList();
            
            if (plantId) {
                title.textContent = 'Editar Planta';
                const plant = plantsData.find(p => p.id === plantId);
                if (plant) {
                    populateForm(plant);
                }
            } else {
                title.textContent = 'Nova Planta';
                map.setView([41.500833, 2.107222], 15);
            }
            
            modal.classList.remove('hidden');
            setTimeout(() => map.invalidateSize(), 100);
        }

        function populateForm(plant) {
            const form = document.getElementById('plantForm');
            
            form.nom_comu.value = plant.nom_comu || '';
            form.nom_cientific.value = plant.nom_cientific || '';
            form.familia.value = plant.familia || '';
            form.tipus.value = plant.tipus || '';
            form.descripcio.value = plant.descripcio || '';
            
            if (plant.coordenades && plant.coordenades.length > 0) {
                plant.coordenades.forEach(coord => {
                    const marker = L.marker([coord.lat, coord.lng]).addTo(map);
                    markers.push(marker);
                });
                map.setView([plant.coordenades[0].lat, plant.coordenades[0].lng], 15);
                updateCoordinatesList();
            }
        }

        function closePlantModal() {
            document.getElementById('plantModal').classList.add('hidden');
            currentPlantId = null;
        }

        function savePlant() {
            const form = document.getElementById('plantForm');
            const formData = new FormData(form);
            
            if (!formData.get('nom_comu') || !formData.get('nom_cientific')) {
                showToast('Els camps nom comú i nom científic són obligatoris', 'error');
                return;
            }
            
            const plant = {
                id: formData.get('nom_comu').toLowerCase()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '')
                    .replace(/\s+/g, '_'),
                nom_comu: formData.get('nom_comu'),
                nom_cientific: formData.get('nom_cientific'),
                familia: formData.get('familia'),
                tipus: formData.get('tipus'),
                descripcio: formData.get('descripcio'),
                coordenades: markers.map(marker => {
                    const latlng = marker.getLatLng();
                    return { lat: latlng.lat, lng: latlng.lng };
                })
            };
            
            if (currentPlantId) {
                const idx = plantsData.findIndex(p => p.id === currentPlantId);
                if (idx !== -1) plantsData[idx] = plant;
            } else {
                plantsData.push(plant);
            }
            
            closePlantModal();
            displayPlants(plantsData);
            updateFilters();
            showToast('Planta desada correctament', 'success');
        }

        function editPlant(plantId) {
            openPlantModal(plantId);
        }

        function deletePlant(plantId) {
            plantToDelete = plantId;
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            plantToDelete = null;
        }

        function confirmDelete() {
            if (!plantToDelete) return;
            
            plantsData = plantsData.filter(p => p.id !== plantToDelete);
            displayPlants(plantsData);
            updateFilters();
            showToast('Planta eliminada correctament', 'success');
            closeDeleteModal();
        }

        function initializeMap() {
            map = L.map('map').setView([41.500833, 2.107222], 15);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            map.on('click', e => {
                markers.forEach(m => map.removeLayer(m)); // Solo una ubicación
                markers = [];
                
                const marker = L.marker([e.latlng.lat, e.latlng.lng]).addTo(map);
                markers.push(marker);
                updateCoordinatesList();
            });
        }

        function updateCoordinatesList() {
            const container = document.getElementById('coordinatesList');
            container.innerHTML = markers.map((marker, index) => {
                const latlng = marker.getLatLng();
                return `
                    <div class="flex justify-between items-center text-sm bg-gray-100 dark:bg-gray-600 px-2 py-1 rounded">
                        <span>${latlng.lat.toFixed(6)}, ${latlng.lng.toFixed(6)}</span>
                        <button onclick="removeMarker(${index})" class="text-red-500 hover:text-red-700 ml-2">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
            }).join('');
        }

        function removeMarker(index) {
            map.removeLayer(markers[index]);
            markers.splice(index, 1);
            updateCoordinatesList();
        }

        function exportJSON() {
            const dataStr = JSON.stringify(plantsData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `plantes-${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('JSON exportat correctament', 'success');
        }

        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 min-w-[300px] flex items-center gap-3`;
            
            const icon = {
                success: 'fa-check-circle text-green-500',
                error: 'fa-exclamation-circle text-red-500',
                info: 'fa-info-circle text-blue-500'
            }[type] || 'fa-info-circle text-blue-500';
            
            toast.innerHTML = `
                <i class="fas ${icon} text-xl"></i>
                <span class="flex-1">${message}</span>
                <button onclick="this.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        function showLoading(show) {
            document.getElementById('loadingIndicator').classList.toggle('hidden', !show);
        }
    </script>
</body>
</html>
